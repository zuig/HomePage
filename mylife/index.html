<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <title>生命计算器</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }

      form {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        margin-top: 50px;
      }

      label {
        font-size: 20px;
        margin-bottom: 10px;
      }

      input[type="number"],
      input[type="date"] {
        margin-bottom: 20px;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 20px;
        width: 300px;
        max-width: 100%;
        box-sizing: border-box;
      }

      table {
        margin: 50px auto;
        border-collapse: collapse;
        font-size: 20px;
        white-space: nowrap;
      }

      th,
      td {
        padding: 10px;
        text-align: center;
        border: 1px solid #ccc;
      }

      th {
        font-weight: bold;
        background-color: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <form>
      <label for="lifeExpectancy">人均寿命:</label>
      <input type="number" id="lifeExpectancy" value="75">

      <label for="birthDate">出生日期:</label>
      <input type="date" id="birthDate" value="1990-04-02">
    </form>

    <table>
      <thead>
        <tr>
          <th>年龄</th>
          <th>月龄</th>
          <th>周龄</th>
          <th>日龄</th>
          <th>时龄</th>
          <th>分龄</th>
          <th>秒龄</th>
        </tr>
      <thead>
      <tbody>
        <tr>
          <td id="ageInYears"></td>
          <td id="ageInMonths"></td>
          <td id="ageInWeeks"></td>
          <td id="ageInDays"></td>
          <td id="ageInHours"></td>
          <td id="ageInMinutes"></td>
          <td id="ageInSeconds"></td>
        </tr>
      </tbody>
      </thead>
        <tr>
          <th>人均剩余年龄</th>
          <th>人均剩余月龄</th>
          <th>人均剩余周龄</th>
          <th>人均剩余日龄</th>
          <th>人均剩余时龄</th>
          <th>人均剩余分龄</th>
          <th>人均剩余秒龄</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="remainingYears"></td>
          <td id="remainingMonths"></td>
          <td id="remainingWeeks"></td>
          <td id="remainingDays"></td>
          <td id="remainingHours"></td>
          <td id="remainingMinutes"></td>
          <td id="remainingSeconds"></td>
        </tr>
      </tbody>
    </table>
    <p id="countdown" align="center"></p>
    <script>
      function initBirthDate() {
        // 读取cookie中保存的出生日期
        var birthdate = getCookie("birthdate");

        // 如果cookie中不存在，则使用默认值
        if (birthdate == "") {
          birthdate = "1990-04-02";
        }

        document.getElementById("birthDate").value = birthdate;
      }

      function saveBirthDate2Cookies() {
        // 将出生日期保存到cookie中，有效期为30天
        setCookie("birthdate", document.getElementById("birthDate").value, 30);
      }

      // 从cookie中获取值的函数
      function getCookie(name) {
        var cookies = document.cookie.split("; ");
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].split("=");
          if (cookie[0] == name) {
            return cookie[1];
          }
        }
        return "";
      }

      // 将值保存到cookie中的函数
      function setCookie(name, value, expiresDays) {
        var date = new Date();
        date.setTime(date.getTime() + (expiresDays * 24 * 60 * 60 * 1000));
        var expires = "expires=" + date.toUTCString();
        document.cookie = name + "=" + value + "; " + expires + "; path=/";
      }

      function calculate() {
        var lifeExpectancy = document.getElementById("lifeExpectancy").value;
        var birthDate = new Date(document.getElementById("birthDate").value);

        var now = new Date();
        var ageInMilliseconds = now.getTime() - birthDate.getTime();
        var ageInSeconds = Math.floor(ageInMilliseconds / 1000);
        var ageInMinutes = Math.floor(ageInSeconds / 60);
        var ageInHours = Math.floor(ageInMinutes / 60);
        var ageInDays = Math.floor(ageInHours / 24);
        var ageInWeeks = Math.floor(ageInDays / 7);
        var ageInMonths = (now.getFullYear() - birthDate.getFullYear()) * 12 + (now.getMonth() - birthDate.getMonth());
        var ageInYears = Math.floor(ageInMonths / 12);

        var remainingYears = lifeExpectancy - ageInYears;
        var remainingMonths = remainingYears * 12;
        var remainingWeeks = remainingYears * 52;
        var remainingDays = remainingYears * 365;
        var remainingHours = remainingDays * 24;
        var remainingMinutes = remainingHours * 60;
        var remainingSeconds = remainingMinutes * 60;

        // Update age and remaining time on the table
        document.getElementById("ageInYears").textContent = ageInYears;
        document.getElementById("ageInMonths").textContent = ageInMonths;
        document.getElementById("ageInWeeks").textContent = ageInWeeks;
        document.getElementById("ageInDays").textContent = ageInDays;
        document.getElementById("ageInHours").textContent = ageInHours;
        document.getElementById("ageInMinutes").textContent = ageInMinutes;
        document.getElementById("ageInSeconds").textContent = ageInSeconds;

        document.getElementById("remainingYears").textContent = remainingYears;
        document.getElementById("remainingMonths").textContent = remainingMonths;
        document.getElementById("remainingWeeks").textContent = remainingWeeks;
        document.getElementById("remainingDays").textContent = remainingDays;
        document.getElementById("remainingHours").textContent = remainingHours;
        document.getElementById("remainingMinutes").textContent = remainingMinutes;
        document.getElementById("remainingSeconds").textContent = remainingSeconds;
      }

      function countDownBirthDate() {
        var lifeExpectancy = document.getElementById("lifeExpectancy").value;
        var birthDate = new Date(document.getElementById("birthDate").value);

        // 计算剩余时间
        var now = new Date();
        var diff = lifeExpectancy * 365 * 24 * 60 * 60 * 1000 - (now - birthDate.getTime());
        var seconds = Math.floor(diff / 1000);
        var minutes = Math.floor(seconds / 60);
        var hours = Math.floor(minutes / 60);
        var days = Math.floor(hours / 24);

        document.getElementById("countdown").textContent = '距离结束还有：' + days + '天 ' + (hours % 24) + '小时 ' + (minutes % 60) + '分钟 ' + (seconds % 60) + '秒';
      }

      initBirthDate();

      // Call the calculate function initially and whenever the input values change
      document.getElementById("lifeExpectancy").addEventListener("input", calculate);
      document.getElementById("birthDate").addEventListener("input", function () {
        calculate();
        saveBirthDate2Cookies();
      });

      setInterval(function() {
        countDownBirthDate();
        calculate();
      }, 1000);
    </script>
  </body>
</html>